{% load static wagtailcore_tags %}
{% load wagtailcore_tags navigation_tags %}

<header class="blue-banner">

  <div class="grid-container padding-1">
    <div class="usa-header__inner display-flex flex-justify flex-align-center">
      <a href="/">
        <img class="tablet:display-none logo-seal" src="{% static 'images/header/logo_seal.png' %}"
          alt="US Tax Court Logo" />
        <img class="display-none tablet:display-block" src="{% static 'images/header/logo.png' %}"
          alt="US Tax Court Logo" />
      </a>

      <a href="https://dawson.ustaxcourt.gov/">
        <img class="dawson" src="{% static 'images/header/dawson.png' %}"
          alt="Dawson Logo" /></a>
    </div>
  </div>
</header>

{% get_site_root as site_root %}
<div class="navigation-bar" data-testid="navigation-bar">
  <img class="nav-hamburger"
    alt="mobile menu hamburger icon"
    src="{% static 'images/header/hamburger.svg' %}" onclick="toggleHeaders()" />
  <ul class="navigation">
    {% for section in navigation_sections %}
    <li class="navigation-header">
      <button aria-expanded="false" class="link" onclick="toggleMenuItems(this)">
        <div>{{ section.title }}
        <i class="ti ti-chevron-right"></i></div>
      </button>
      <ul class="navigation-list">
        {% for menuitem in site_root.get_children.live.in_menu %}
        {% if menuitem.specific.navigation_category == section.key %}
          {% if menuitem.specific.redirectLink %}
            <li class="nav-link">
              <a target="_blank" href="{{ menuitem.specific.redirectLink }}">
                <i class="ti ti-chevron-right"></i>
                {{ menuitem.specific.menu_item_name }}
              </a>
            </li>
          {% else %}
            <li class="nav-link">
              <a href="{% pageurl menuitem %}">
                <i class="ti ti-chevron-right"></i>
                {{ menuitem.specific.menu_item_name }}
              </a>
            </li>
          {% endif %}
        {% endif %}
        {% endfor %}
      </ul>
    </li>
    {% endfor %}
  </ul>
</div>

{% block extra_js %}
<script>
  function toggleHeaders() {
    const elements = document.getElementsByClassName("navigation-header");
    for (element of elements) {
      element.classList.toggle("displayed-navigation-header");
    }
  }
  function toggleMenuItems(element) {
    const navigationList = element.parentElement.querySelector('.navigation-list');
    const isExpanded = element.getAttribute('aria-expanded') === 'true';

    element.setAttribute('aria-expanded', !isExpanded);

    if (navigationList) {
      if (isExpanded) {
        // When closing, temporarily prevent hover from showing the menu
        navigationList.classList.add('force-hide');
        // Remove the force-hide class after a short delay
        setTimeout(() => {
          navigationList.classList.remove('force-hide');
        }, 300);
      }
      navigationList.classList.toggle('displayed-navigation-list');
    }
  }
  document.querySelectorAll('.navigation-header').forEach(header => {
    const button = header.querySelector('button');
    const navigationList = header.querySelector('.navigation-list');

    // Handle button keyboard events
    button.addEventListener('keydown', event => {
      if (event.code === 'Space' || event.code === 'Enter') {
        event.preventDefault();
        if (navigationList && navigationList.childElementCount > 0) {
          toggleMenuItems(button);
        }
      }
    });

    // Handle navigation link keyboard events
    const navLinks = header.querySelectorAll('.nav-link a');
    navLinks.forEach(link => {
      link.addEventListener('keydown', event => {
        if (event.code === 'Space') {
          event.preventDefault();
          link.click();
        }
      });
    });
  });
</script>
{% endblock %}
