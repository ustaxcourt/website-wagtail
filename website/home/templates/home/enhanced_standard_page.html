{% extends 'base.html' %}
{% load wagtailcore_tags %}
{% load filters %}
{% load static %}
{% block extra_css %}
    <style>
        .enhanced-page {
            .links {
                i {
                    padding-right: .4em
                }
            }

            .question-answer-block {
                display: flex;
                position: relative;

                .bookmark {
                    position: absolute;
                    left: -22px;
                    top: 24px;
                }
            }

            .usa-button {
                width: 80%;
                margin: 1em;
                display: block;
                font-weight: normal;
            }
        }


        @media (max-width: 1024px) {
            .enhanced-page {
                .question-answer-block {
                    .bookmark {
                        top: 24px;
                        left: -4px;
                    }

                    h3 {
                        padding-left: 16px;
                    }
                }
            }
        }
    </style>
{% endblock %}
{% block body_class %}template-standard_page{% endblock %}
{% block content %}
    <div class="enhanced-page grid-container padding-bottom-2 padding-top-2">
        <h1 data-testid="page-title">{{ page.title }}</h1>
        <hr />
        {% if page.navigation_ribbon %}
            <div class="blue-page-links-bar">
                {% for link in page.navigation_ribbon.links.all %}
                <a href="{{ link.url }}"><i class="{{ link.icon }}"></i>
                <div class="title">{{ link.title }}</div>
            </a>
        {% endfor %}
    </div>
{% endif %}
{% for block in page.body %}
    {% with page_url=page.url|strip_trailing_slash %}
        {% if block.block_type == 'heading' %}
            <h2>{{ block.value }}</h2>
        {% elif block.block_type == 'h2' %}
            <h2>{{ block.value }}</h2>
        {% elif block.block_type == 'h3' %}
            <h3>{{ block.value }}</h3>
        {% elif block.block_type == 'h4' %}
            <h4>{{ block.value }}</h4>
        {% elif block.block_type == 'paragraph' %}
            <p data-testid="page-body-paragraph">{{ block.value }}</p>
        {% elif block.block_type == 'image' %}
            <img src="{{ block.value.url }}" alt="{{ block.value.alt }}">
        {% elif block.block_type == 'hr' %}
            <hr />
        {% elif block.block_type == 'links' %}
            <ul class="links {{ block.value.class }}">
                {% for link in block.value.links %}
                    {% if link.document %}
                        <li>
                            <a href="{{ link.document.url }}"
                               data-testid="document-link"
                               title="{{ link.title }}"><i class="{{ link.icon }}"></i> {{ link.title }}</a>
                        </li>
                    {% else %}
                        <li>
                            {% if link.url %}
                                <a href="{{ link.url }}" title="{{ link.title }}"><i class="{{ link.icon }}"></i> {{ link.title }}</a>
                            {% endif %}
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        {% elif block.block_type == 'questionanswers' %}
            <ul class="links indented">
                {% for q in block.value %}
                    <li>
                        <a href="{{ page_url }}#{{ q.anchortag }}">
                            <i class="ti ti-info-circle-filled"></i>{{ q.question }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
            <hr />
            {% for q in block.value %}
                <div class="question-answer-block">
                    <a href="{{ page_url }}#{{ q.anchortag }}" title="{{ q.question }}">
                        <div class="ti ti-bookmark-filled bookmark" id="{{ q.anchortag }}"></div>
                    </a>
                    <h3>{{ q.question }}</h3>
                </div>
                <div>{{ q.answer|richtext }}</div>
                <hr />
            {% endfor %}
        {% elif block.block_type == 'columns' %}
            {% with column_count=block.value.column|length %}
                <div class="grid-row">
                    {% for column in block.value.column %}
                        <div class="grid-col-12 tablet:grid-col-{{ column_count|column_width }}">
                            {% for sub_block in column %}
                                {% if sub_block.block_type == 'h2WithAnchorTag' %}
                                    <h2 id="{{ sub_block.value.anchortag }}">{{ sub_block.value.text }}</h2>
                                {% elif sub_block.block_type == 'clickableButton' %}
                                    <a href="{{ sub_block.value.url }}" class="usa-button">{{ sub_block.value.text }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            {% endwith %}
        {% else %}
            <p>Block type not recognized: {{ block.block_type }}</p>
            {{ block.value }}
        {% endif %}
    {% endwith %}
{% endfor %}
</div>
{% endblock content %}
